<!doctype html>
<html lang="zh-Hans" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"><title data-react-helmet="true">✌️ 索引 | 面试知识点整理</title><meta data-react-helmet="true" property="og:url" content="https://interview.docs.lixiangyu.xyz/mysql/m-index"><meta data-react-helmet="true" name="docusaurus_locale" content="zh-Hans"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="✌️ 索引 | 面试知识点整理"><meta data-react-helmet="true" name="description" content="----"><meta data-react-helmet="true" property="og:description" content="----"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://interview.docs.lixiangyu.xyz/mysql/m-index"><link data-react-helmet="true" rel="alternate" href="https://interview.docs.lixiangyu.xyz/mysql/m-index" hreflang="zh-Hans"><link data-react-helmet="true" rel="alternate" href="https://interview.docs.lixiangyu.xyz/mysql/m-index" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9d41a9de.css">
<link rel="preload" href="/assets/js/runtime~main.72fc5b91.js" as="script">
<link rel="preload" href="/assets/js/main.ff0391fe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">面试知识点整理</b></a><a class="navbar__item navbar__link" href="/">主页</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__item navbar__link">其他内容</a><ul class="dropdown__menu"><li><a href="https://blog.lixiangyu.xyz" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>个人博客<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/lxy1152/docs-interview" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="请输入要搜索的内容" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">简介</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">😉 Java 基础</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🌈 Java 容器</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🐺 Java 并发</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🌏 JVM</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🌱 框架使用</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">👊 MySQL</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/normal-form">🤚 范式</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/datatype">👋 数据类型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/engine">🖐️ 存储引擎</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/ddl">🖖 DDL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/transcation">👍 事务</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/mysql/m-index">✌️ 索引</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/lock">🤞 锁</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/slow-query">👎 慢查询</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/view">👂 视图</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mysql/cluster">🤝 集群</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🤷‍♂️ Redis</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🎠 中间件</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">👨‍👧‍👧 计算机网络</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🦸 操作系统</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">🏭 设计思想</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">📚 面经</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">本页总览</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">✌️ 索引</h1></header><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="为什么使用数据库索引可以提高效率？"></a>为什么使用数据库索引可以提高效率？<a class="hash-link" href="#为什么使用数据库索引可以提高效率？" title="标题的直接链接">#</a></h2><p>默认执行 SQL 语句时是进行全表扫描的，遇到匹配条件的就加入结果集。如果有索引，就会先去索引表中一次定位到特定值的行数，减少遍历匹配的行数。索引把无序的数据变成了相对有序的数据结构。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="索引的底层数据结构是什么？"></a>索引的底层数据结构是什么？<a class="hash-link" href="#索引的底层数据结构是什么？" title="标题的直接链接">#</a></h2><p>B+ 树。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是-b-树？"></a>什么是 B+ 树？<a class="hash-link" href="#什么是-b-树？" title="标题的直接链接">#</a></h2><p>B Tree 指的是 Balance Tree，也就是平衡树。平衡树是一颗查找树，并且所有叶子节点位于同一层。</p><p>B+ Tree 是基于 B Tree 和叶子节点顺序访问指针进行实现的，它具有 B Tree 的平衡性，并且可以通过顺序访问指针来提高区间查询的性能。在 B+ Tree 中，一个节点中的 <code>key</code> 从左到右非递减排列，如果某个指针的左右相邻 <code>key</code> 分别是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">key_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">key_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em"><span></span></span></span></span></span></span></span></span></span></span>，且不为 <code>null</code>，则该指针指向节点的所有 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">key</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span> 大于等于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">key_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> 且小于等于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">key_{i+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.902771em;vertical-align:-0.208331em"></span><span class="mord mathnormal" style="margin-right:0.03148em">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em"><span></span></span></span></span></span></span></span></span></span></span>。</p><p><img src="https://i.loli.net/2021/07/30/xu6AGHYJw5NvXC9.png" alt="B+_树.jpg"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="为什么采用-b-树而不是-b-树？"></a>为什么采用 B+ 树而不是 B 树？<a class="hash-link" href="#为什么采用-b-树而不是-b-树？" title="标题的直接链接">#</a></h2><p>B+ 树和 B 树的区别：</p><ul><li>B+ 树非叶子节点只存储关键字和指向子节点的指针，而 B 树还存储了数据，在同样大小的情况下，B+ 树可以存储更多的关键字</li><li>B+ 树叶子节点存储了所有关键字和数据，并且多个节点用链表连接，可以快速进行范围查找</li><li>B+ 树非叶子节点不存储数据，所以查询时间复杂度固定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span>，B 树查询时间复杂度不固定，最好是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="为什么采用-b-树而不是红黑树？"></a>为什么采用 B+ 树而不是红黑树？<a class="hash-link" href="#为什么采用-b-树而不是红黑树？" title="标题的直接链接">#</a></h2><p>红黑树等平衡树也可以用来实现索引，但是文件系统及数据库系统普遍采用 B+ 树作为索引结构，这是因为使用 B+ 树访问磁盘数据有更高的性能。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="b-树有更低的树高"></a>B+ 树有更低的树高<a class="hash-link" href="#b-树有更低的树高" title="标题的直接链接">#</a></h3><p>平衡树的树高 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>h</mi><mo stretchy="false">)</mo><mtext> </mtext><mo>=</mo><mtext> </mtext><mi>O</mi><mo stretchy="false">(</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mi>d</mi></msub><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(h)\ =\ O(\log_dN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.24196799999999993em"><span style="top:-2.4558600000000004em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:0.10903em">N</span><span class="mclose">)</span></span></span></span></span>，其中 <code>d</code> 为每个节点的出度。红黑树的出度为 <code>2</code>，而 B+ 树的出度一般都非常大，所以红黑树的树高 <code>h</code> 很明显比 B+ 树大非常多。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="磁盘访问原理"></a>磁盘访问原理<a class="hash-link" href="#磁盘访问原理" title="标题的直接链接">#</a></h3><p>操作系统一般将内存和磁盘分割成固定大小的块，每一块称为一页，内存与磁盘以页为单位交换数据。数据库系统将索引的一个节点的大小设置为页的大小，使得一次 I/O 就能完全载入一个节点。</p><p>如果数据不在同一个磁盘块上，那么通常需要移动制动手臂进行寻道，而制动手臂因为其物理结构导致了移动效率低下，从而增加磁盘数据读取时间。B+ 树相对于红黑树有更低的树高，进行寻道的次数与树高成正比，在同一个磁盘块上进行访问只需要很短的磁盘旋转时间，所以 B+ 树更适合磁盘数据的读取。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="磁盘预读特性"></a>磁盘预读特性<a class="hash-link" href="#磁盘预读特性" title="标题的直接链接">#</a></h3><p>为了减少磁盘 I/O 操作，磁盘往往不是严格按需读取，而是每次都会预读。预读过程中，磁盘进行顺序读取，顺序读取不需要进行磁盘寻道，并且只需要很短的磁盘旋转时间，速度会非常快。并且可以利用预读特性，相邻的节点也能够被预先载入。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是聚簇和非聚簇索引？"></a>什么是聚簇和非聚簇索引？<a class="hash-link" href="#什么是聚簇和非聚簇索引？" title="标题的直接链接">#</a></h2><ul><li>聚簇索引，又叫主键索引，每个表只有一个主键索引，即每张表按照主键构造一颗 B+ 树，叶子节点中存放的就是整张表的记录数据</li><li>非聚簇索引，又叫辅助索引，叶子节点保存相应行数据的主键索引值</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是前缀索引？"></a>什么是前缀索引？<a class="hash-link" href="#什么是前缀索引？" title="标题的直接链接">#</a></h2><p>如果列的值较长，比如 <code>blob</code>、<code>text</code>、<code>varchar</code> 就必须建立前缀索引，即将值的前一部分（或后一部分）作为索引。这样既可以节约空间，又可以提高查询效率。但无法使用前缀索引做 <code>order by</code> 和 <code>group by</code>，也无法使用前缀索引做覆盖扫描。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是覆盖索引？"></a>什么是覆盖索引？<a class="hash-link" href="#什么是覆盖索引？" title="标题的直接链接">#</a></h2><p>覆盖索引是指 <code>select</code> 语句所查找的数据列从索引中就能获得，不必再从数据表中读取。如果一个索引包含了（或覆盖了）满足查询语句中字段与条件的数据就叫做覆盖索引。当发起一个被索引覆盖的查询（也叫作索引覆盖查询）时，在解释方案的 Extra 列会提示 Using index。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>回表查询</h5></div><div class="admonition-content"><p>如果通过一个索引树不能拿到所有的数据，那么就会根据辅助索引中叶子节点所对应的主键去主键索引树种查询需要的信息，这种方式叫做回表查询。由于需要查多棵树，所以效率肯定会降低。举个例子：</p><p>假设用户表（user）需要保存用户 id，用户姓名（name），用户性别（sex）。主键是 id，在 name 列上建了一个索引。如果使用下面的 sql 进行查询就使用到了覆盖索引，因为通过 name 索引树可以获得 name 和对应的 id（name 索引树的叶子节点保存会保存主键）：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>相反如果使用下面的 sql 进行查询，将导致回表查询，因为 name 索引树种不包含 sex 的信息，这个信息必须通过主键索引树进行获取：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sex </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ?</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么情况会导致索引失效？"></a>什么情况会导致索引失效？<a class="hash-link" href="#什么情况会导致索引失效？" title="标题的直接链接">#</a></h2><p>对于以下情况，索引会失效：</p><ul><li><code>like</code> 以 % 开头</li><li><code>or</code> 查询，必须左右字段都是索引，否则索引失效</li><li>联合索引，遵从最左匹配原则，如果不是使用第一列索引，索引失效</li><li>数据出现隐形转换，如 <code>varchar</code> 字段没加单引号，自动转为 <code>int</code> 类型，会使索引失效</li><li>索引字段使用 <code>not</code>、<code>&lt;&gt;</code>、<code>!=</code> 会使索引失效</li><li>索引字段使用函数，索引无效</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是最左匹配原则？"></a>什么是最左匹配原则？<a class="hash-link" href="#什么是最左匹配原则？" title="标题的直接链接">#</a></h2><p>对于联合索引，这些值在 B+ 树中存储时，是按照第一个值升序、第二个值升序...第 n 个值升序的方式来排列的（如果某个值相同，那么会比较下一个值）。举个例子：假设索引列是 a、b、c，那么索引中保存的结构可能是：</p><p>（1，1，1），（1，1，2），（1，2，1），（1，2，2），（2，1，1）......</p><p>因此，如果查询时未指定最左侧的列，那么将不能快速定位数据的范围，导致 MySQL 需要进行全表（或范围）扫描。 还是以上面的内容举例，比如我用使用这个语句来搜索：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tableName </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>由于没有指定 a 的值，那么只能挨个访问记录，看一下 b 是不是等于 2。相反，如果我用这个语句来搜索：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tableName </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o clean-btn">复制</button></div></div><p>由于指定了 a = 1，那么只需要在有限的集合中进行查找就可以了。通过 <code>explain</code> 也可以看到上述两条语句的区别。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是-mysql-索引重建，为什么需要索引重建？"></a>什么是 Mysql 索引重建，为什么需要索引重建？<a class="hash-link" href="#什么是-mysql-索引重建，为什么需要索引重建？" title="标题的直接链接">#</a></h2><p>数据库在删除数据时只是将原始数据标记为已删除，实际上并没有释放空间，这会造成页面中有很多空洞，所以需要重建索引提高页面页面利用率。索引重建的过程会创建一个新的索引，把数据按顺序插入，使索引更紧凑、更省空间。重建索引的方式包括：</p><ul><li><code>mysqldump</code> 导出然后重新导入</li><li><code>alter table tableName ENGINE = InnoDB</code></li><li><code>alter table tableName drop/add index k</code></li><li><code>alter table tableName drop/add primary key</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="解释方案中关键的字段有哪些？"></a>解释方案中关键的字段有哪些？<a class="hash-link" href="#解释方案中关键的字段有哪些？" title="标题的直接链接">#</a></h2><p>在一个语句的前面添加 <code>explain</code> 就可以获得这个语句的执行方案。在执行方案中有几个比较关键的字段（以下内容只列举了一部分，实际上内容很多）：</p><table><tr><th>字段</th><th>字段含义</th><th>可能的取值</th><th>这个取值的含义</th></tr><tr><th rowspan="3">type</th><td rowspan="3">查找类型</td><td>all</td><td>表示此次查询进行了全表扫描</td></tr><tr><td>const</td><td>表示表中有多条记录，但只从表中查询一条记录</td></tr><tr><td>index</td><td>表示对表中的索引进行了完整的扫描</td></tr><tr><th>possible_keys</th><td>查询可能使用到的索引都会在这里列出来，如果为空说明没有可用的索引</td><td></td><td></td></tr><tr><th>key</th><td>实际使用的索引</td><td></td><td></td></tr><tr><th>rows</th><td>表示查询的行数，这个值是一个估计值</td><td></td><td></td></tr><tr><th>extra</th><td>额外的信息说明</td><td>using_index</td><td>表示此次查询利用了覆盖索引</td></tr></table></div><footer class="row docusaurus-mt-lg"><div class="col"></div><div class="col lastUpdated_3DPF">最后更新于 <b><time datetime="2021-08-16T09:53:20.000Z">2021/8/16</time></b> </div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mysql/transcation"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">« 👍 事务</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mysql/lock"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">🤞 锁 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#为什么使用数据库索引可以提高效率？" class="table-of-contents__link">为什么使用数据库索引可以提高效率？</a></li><li><a href="#索引的底层数据结构是什么？" class="table-of-contents__link">索引的底层数据结构是什么？</a></li><li><a href="#什么是-b-树？" class="table-of-contents__link">什么是 B+ 树？</a></li><li><a href="#为什么采用-b-树而不是-b-树？" class="table-of-contents__link">为什么采用 B+ 树而不是 B 树？</a></li><li><a href="#为什么采用-b-树而不是红黑树？" class="table-of-contents__link">为什么采用 B+ 树而不是红黑树？</a><ul><li><a href="#b-树有更低的树高" class="table-of-contents__link">B+ 树有更低的树高</a></li><li><a href="#磁盘访问原理" class="table-of-contents__link">磁盘访问原理</a></li><li><a href="#磁盘预读特性" class="table-of-contents__link">磁盘预读特性</a></li></ul></li><li><a href="#什么是聚簇和非聚簇索引？" class="table-of-contents__link">什么是聚簇和非聚簇索引？</a></li><li><a href="#什么是前缀索引？" class="table-of-contents__link">什么是前缀索引？</a></li><li><a href="#什么是覆盖索引？" class="table-of-contents__link">什么是覆盖索引？</a></li><li><a href="#什么情况会导致索引失效？" class="table-of-contents__link">什么情况会导致索引失效？</a></li><li><a href="#什么是最左匹配原则？" class="table-of-contents__link">什么是最左匹配原则？</a></li><li><a href="#什么是-mysql-索引重建，为什么需要索引重建？" class="table-of-contents__link">什么是 Mysql 索引重建，为什么需要索引重建？</a></li><li><a href="#解释方案中关键的字段有哪些？" class="table-of-contents__link">解释方案中关键的字段有哪些？</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">其他内容</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.lixiangyu.xyz" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>个人博客<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.72fc5b91.js"></script>
<script src="/assets/js/main.ff0391fe.js"></script>
</body>
</html>